function addCookie(i,t,o){var n=new Date;n.setDate(n.getDate()+o),document.cookie=i+"="+encodeURI(t)+";expires="+n}function getCookie(i){for(var t=decodeURI(document.cookie).split("; "),o=0;o<t.length;o++){var n=t[o].split("=");if(n[0]==i)return n[1]}}function delCookie(i){addCookie(i,"",-1)}function createcart(e,s){$.ajax({url:"json/cart.json",dataType:"json"}).done(function(i){for(var t=0;t<i.length;t++)if(e==i[t].sid){var o=$(".goods-item:hidden").clone(!0);o.find(".goods-pic").find("img").attr("src",i[t].img),o.find(".goods-pic").find("img").attr("sid",i[t].sid),o.find(".goods-d-info").find("a").html(i[t].title),o.find(".b-price").find("strong").html(i[t].price),o.find(".quantity-form").find("input").val(s);var n=parseFloat(o.find(".b-price strong").html());o.find(".b-sum strong").html((n*s).toFixed(2)),o.css("display","block"),$(".item-list").append(o),kong(),totalprice()}})}$.ajax({url:"json/cart.json",dataType:"json"}).done(function(i){for(var t="",o=0;o<4;o++)t+='<li><div class="goodsinfo"><div class="p-img"><a href="##"><img class="loadimg" src="'+i[o].img+'" alt="" sid="'+i[o].sid+'" /></a></div><div class="p-name"><a class="loadt" href="##">'+i[o].title+'</a></div><div class="p-price"><strong><em>￥</em><i class="loadpcp">'+i[o].price+'</i></strong></div><div class="p-btn"><a href="javascript:void(0)"><b></b>加入购物车</a></div></div></li>';$(".goods-list ul").html(t)});var sidarr=[],numarr=[];function cookieToArray(){getCookie("cartsid")&&(sidarr=getCookie("cartsid").split(",")),getCookie("cartnum")&&(numarr=getCookie("cartnum").split(","))}if($(".goods-list ul").on("click",".p-btn a",function(){var o=$(this).parents(".goodsinfo").find(".loadimg").attr("sid");cookieToArray(),-1!=$.inArray(o,sidarr)?$(".goods-item:visible").each(function(){if(o==$(this).find("img").attr("sid")){var i=$(this).find(".quantity-form input").val();i++,$(this).find(".quantity-form input").val(i);var t=parseFloat($(this).find(".b-price strong").html());$(this).find(".b-sum strong").html((t*i).toFixed(2)),numarr[$.inArray(o,sidarr)]=i,addCookie("cartnum",numarr.toString(),7),totalprice()}}):(sidarr.push(o),addCookie("cartsid",sidarr.toString(),7),numarr.push(1),addCookie("cartnum",numarr.toString(),7),createcart(o,1),totalprice())}),getCookie("cartsid")&&getCookie("cartnum"))for(var s=getCookie("cartsid").split(","),n=getCookie("cartnum").split(","),i=0;i<s.length;i++)createcart(s[i],n[i]);function kong(){getCookie("cartsid")?$(".empty-cart").hide():$(".empty-cart").show()}function totalprice(){var i=0,t=0;$(".goods-item:visible").each(function(){$(this).find("input:checkbox").is(":checked")&&(i+=parseFloat($(this).find(".b-sum strong").html()),t+=parseInt($(this).find(".quantity-form").find("input").val()))}),$(".totalprice").html("￥"+i.toFixed(2)),$(".amount-sum em").html(t)}function singlegoodsprice(i){return(parseFloat(i.parents(".goods-item").find(".b-price").find("strong").html())*parseInt(i.parents(".goods-item").find(".quantity-form input").val())).toFixed(2)}function setcookie(i){cookieToArray();var t=i.parents(".goods-item").find("img").attr("sid");numarr[sidarr.indexOf(t)]=i.parents(".goods-item").find(".quantity-form input").val(),addCookie("cartnum",numarr.toString(),7)}kong(),$(".quantity-add").on("click",function(){var i=$(this).parents(".goods-item").find(".quantity-form input").val();99<=++i&&(i=99),$(this).parents(".goods-item").find(".quantity-form input").val(i),$(this).parents(".goods-item").find(".b-sum").find("strong").html(singlegoodsprice($(this))),totalprice(),setcookie($(this))}),$(".quantity-down").on("click",function(){var i=$(this).parents(".goods-item").find(".quantity-form input").val();--i<=1&&(i=1),$(this).parents(".goods-item").find(".quantity-form input").val(i),$(this).parents(".goods-item").find(".b-sum").find("strong").html(singlegoodsprice($(this))),totalprice(),setcookie($(this))}),$(".quantity-form input").on("input",function(){var i=parseInt($(this).val());/^\d+$/g.test(i)?99<=i?$(this).val(99):i<=0?$(this).val(1):$(this).val(i):$(this).val(1),$(this).parents(".goods-item").find(".b-sum").find("strong").html(singlegoodsprice($(this))),totalprice(),setcookie($(this))}),$(".allsel").on("change",function(){$(".goods-item:visible").find("input:checkbox").prop("checked",$(this).prop("checked")),$(".allsel").prop("checked",$(this).prop("checked")),totalprice()});var $inputchecked=$(".goods-item:visible").find("input:checkbox");function delgoodslist(i,t){for(var o=-1,n=0;n<t.length;n++)i==t[n]&&(o=n);t.splice(o,1),numarr.splice(o,1),addCookie("cartsid",t.toString(),7),addCookie("cartnum",numarr.toString(),7)}$(".item-list").on("change",$inputchecked,function(){var i=$(".goods-item:visible").find("input:checkbox");$(".goods-item:visible").find("input:checked").length==i.size()?$(".allsel").prop("checked",!0):$(".allsel").prop("checked",!1),totalprice()}),$(".item-list").on("click",".b-action a",function(i){cookieToArray(),confirm("你确定要删除吗？")&&$(this).first().parents(".goods-info").remove(),delgoodslist($(this).first().parents(".goods-info").find("img").attr("sid"),sidarr),totalprice()}),$(".operation a:first").on("click",function(){$(".goods-item:visible").each(function(){$(this).find("input:checkbox").is(":checked")&&($(this).remove(),delgoodslist($(this).find("img").attr("sid"),sidarr))}),totalprice()});